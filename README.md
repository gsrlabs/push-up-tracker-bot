# Telegram‑бот для учёта отжиманий.
## 1. Функциональные требования
1. **Главное меню**
   При старте или по команде `/start` бот выводит три кнопки:

   * Добавить отжимания
   * Статистика за сегодня
   * Статистика за всё время

2. **Добавить отжимания**

   * Пользователь нажимает кнопку «Добавить отжимания».
   * Бот просит ввести число (целое).
   * После ввода бот отвечает:

     ```
     Добавлено: <n> отжиманий  
     Ваш прогресс: <сумма_за_сегодня>/100  
     ```
   * Если сумма за сегодня ≥ 100, добавляется сообщение:

     ```
     Вы выполнили дневную норму!
     ```

3. **Статистика за сегодня**

   * При выборе этой кнопки бот выводит:

     ```
     <username>: <сумма_за_сегодня> отжиманий
     ```

4. **Статистика за всё время**

   * При выборе этой кнопки бот выводит:

     ```
     <username>: <сумма_за_всё_время> отжиманий
     ```

---

## 2. Технический стек

* Язык: **Go**
* Библиотека для Telegram API: (например) `github.com/go-telegram-bot-api/telegram-bot-api/v5`

---

## 3. Хранение данных

* **СУБД:** PostgreSQL
* **Схема таблицы:**

  ```sql
  CREATE TABLE pushups (
    user_id    BIGINT NOT NULL,
    date       DATE   NOT NULL,
    count      INT    NOT NULL,
    PRIMARY KEY (user_id, date)
  );
  ```

---

## 4. Параллелизм и надёжность

1. **Горутины и Mutex**

   * Каждый входящий запрос обрабатывается в отдельной горутине.
   * Для защиты разделяемых ресурсов (кеш, соединения) используем `sync.Mutex` или `sync.RWMutex`.

2. **Таймауты**

   * Контекст с таймаутом (`context.WithTimeout`) для каждого запроса к базе:

     ```go
     ctx, cancel := context.WithTimeout(context.Background(), 2*time.Second)
     defer cancel()
     ```

3. **Ограничение соединений**

   * Конфигурация пула соединений:

     ```go
     db.SetMaxOpenConns(10)
     db.SetMaxIdleConns(5)
     db.SetConnMaxLifetime(30 * time.Minute)
     ```

---

## 5. Дополнительные требования

* **Кеширование** статистики за сегодня в памяти (например, с `sync.Map`), чтобы не ходить в базу при каждом запросе «Статистика за сегодня».
* **Логирование** запросов и ошибок с помощью `logrus` или встроенного `log`.
* **Миграции** базы — используйте `golang-migrate` для управления схемой.
* **Тестирование** — пишите юнит‑тесты для обработчиков и интеграционные тесты для работы с БД.
* **Docker** — контейнеризация приложения и базы для простого развёртывания.

---
